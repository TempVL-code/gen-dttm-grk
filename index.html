<!DOCTYPE html>
<html lang="uk" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ü–æ–¢—É–∂–Ω–∏–π –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –î–∞—Ç</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    :root {
      --bg: #f6f0ff;
      --bg-soft: #f9f5ff;
      --text: #2b2240;
      --muted: #7c7199;
      --card: #ffffff;
      --border: #e0d4ff;
      --accent: #7c3aed;
      --accent-soft: #ede7ff;
      --accent-strong: #5b21b6;
      --error: #f97373;
      --error-soft: #ffe5e5;
      --success: #22c55e;
      --shadow-soft: 0 10px 30px rgba(148, 119, 255, 0.18);
    }

    [data-theme="dark"] {
      --bg: #100b1f;
      --bg-soft: #181024;
      --text: #f4f1ff;
      --muted: #b3a7d6;
      --card: #1f1633;
      --border: #3b2c59;
      --accent: #a855f7;
      --accent-soft: #2b1a47;
      --accent-strong: #c4b5fd;
      --error: #fb7185;
      --error-soft: #3b1020;
      --success: #22c55e;
      --shadow-soft: 0 14px 40px rgba(0, 0, 0, 0.55);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: radial-gradient(circle at top left, #fce7ff 0, var(--bg) 40%);
      color: var(--text);
      margin: 0;
      padding: 30px 20px 40px;
      min-height: 100vh;
      line-height: 1.5;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    h1 {
      margin: 0;
      font-size: 2.1rem;
      letter-spacing: 0.03em;
    }

    .subtitle {
      font-size: 0.95rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-strong);
      font-size: 0.78rem;
      font-weight: 600;
      border: 1px solid rgba(124, 58, 237, 0.18);
    }

    .theme-toggle {
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      font-size: 1.2rem;
      width: 40px;
      height: 40px;
      border-radius: 999px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-soft);
    }

    .main-card {
      background: var(--card);
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 1.5rem 1.6rem 1.8rem;
    }

    .main-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.2rem;
    }

    .main-card-title {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .pill {
      padding: 0.15rem 0.55rem;
      border-radius: 999px;
      font-size: 0.8rem;
      background: var(--accent-soft);
      color: var(--accent-strong);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr 1.2fr;
      gap: 1.1rem;
      margin-bottom: 1.4rem;
    }

    @media (max-width: 900px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    label {
      display: block;
      margin-bottom: 0.35rem;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .hint {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 0.1rem;
    }

    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 0.65rem 0.9rem;
      background: var(--bg-soft);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 10px;
      font-size: 0.95rem;
    }

    input[disabled] {
      background: #e9e1ff;
      color: var(--muted);
      cursor: not-allowed;
    }

    textarea {
      resize: vertical;
      min-height: 130px;
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .btn {
      padding: 0.7rem 1.5rem;
      font-size: 0.95rem;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: white;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      box-shadow: 0 10px 25px rgba(124, 58, 237, 0.45);
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
      white-space: nowrap;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(124, 58, 237, 0.6);
      opacity: 0.96;
    }

    .btn-secondary {
      background: var(--bg-soft);
      color: var(--muted);
      border: 1px solid var(--border);
      box-shadow: none;
      text-transform: none;
      letter-spacing: 0;
    }

    .btn-secondary:hover {
      transform: none;
      box-shadow: none;
      background: #efe7ff;
    }

    .actions {
      display: flex;
      gap: 0.8rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    .error {
      color: var(--error);
      background: var(--error-soft);
      padding: 0.8rem 1rem;
      border-radius: 12px;
      margin: 1rem 0;
      border: 1px solid rgba(248,113,113,0.6);
      font-size: 0.9rem;
    }

    .result-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      align-items: center;
      justify-content: space-between;
      margin: 1.2rem 0 0.8rem;
      font-size: 0.9rem;
    }

    .result-main {
      font-weight: 500;
    }

    .result-extra {
      color: var(--muted);
      font-size: 0.82rem;
    }

    .result-extra strong {
      font-weight: 600;
    }

    .chip {
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      background: var(--bg-soft);
      border: 1px dashed var(--border);
      font-size: 0.78rem;
      color: var(--muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border-radius: 14px;
      overflow: hidden;
      font-size: 0.9rem;
    }

    th, td {
      padding: 0.6rem 0.9rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
      white-space: nowrap;
    }

    th {
      background: var(--accent-soft);
      color: var(--accent-strong);
      font-weight: 600;
      font-size: 0.84rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    tbody tr:nth-child(even) {
      background: var(--bg-soft);
    }

    .scroll-box {
      max-height: 420px;
      overflow: auto;
      border-radius: 14px;
      border: 1px solid var(--border);
    }

    .hidden {
      display: none;
    }

    .header-tabs {
      display: flex;
      gap: 0.5rem;
      font-size: 0.85rem;
    }

    .header-tabs span {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      border: 1px solid transparent;
      color: var(--muted);
    }

    .header-tabs span.active {
      background: var(--accent-soft);
      border-color: rgba(124, 58, 237, 0.4);
      color: var(--accent-strong);
      font-weight: 600;
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <div class="title-block">
      <span class="badge">‚öôÔ∏è –ü–æ–¢—É–∂–Ω–∏–π –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –î–∞—Ç</span>
      <h1>–ü–æ–¢—É–∂–Ω–∏–π –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –î–∞—Ç–ì–æ–¥–∏–Ω</h1>
      <div class="subtitle">–ê–Ω–∞–ª—ñ–∑ ¬∑ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è ¬∑ Excel</div>
    </div>
    <button class="theme-toggle" id="themeBtn" title="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">üåô</button>
  </header>

  <div class="main-card">
    <div class="main-card-header">
      <div class="main-card-title">
        <span>–î–∞–Ω—ñ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó</span>
        <span class="pill">XLSX / CSV –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è</span>
      </div>
      <div class="header-tabs">
        <span class="active">–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è</span>
        <span>–ï–∫—Å–ø–æ—Ä—Ç</span>
      </div>
    </div>

    <form id="genForm">
      <div class="form-grid">
        <div>
          <label for="start">–î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É</label>
          <input type="date" id="start" required>
        </div>
        <div>
          <label for="end">–î–∞—Ç–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è</label>
          <input type="date" id="end" required>
        </div>
        <div>
          <label for="count">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤</label>
          <input type="number" id="count" min="1" max="10000" value="100" required>
          <div class="hint" id="countHint">
            –Ø–∫—â–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–µ –ø–æ–ª–µ ¬´–£–Ω—ñ–∫–∞–ª—å–Ω—ñ –Ω–æ–º–µ—Ä–∏¬ª ‚Äì –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –ø–æ —ó—Ö –∫—ñ–ª—å–∫–æ—Å—Ç—ñ.
          </div>
        </div>
        <div>
          <label for="dateFmt">–§–æ—Ä–º–∞—Ç –¥–∞—Ç–∏</label>
          <select id="dateFmt">
            <option value="0">YYYY-MM-DD</option>
            <option value="1" selected>DD.MM.YYYY</option>
            <option value="2">DD/MM/YYYY</option>
            <option value="3">MM/DD/YYYY</option>
          </select>
        </div>
        <div>
          <label for="timeFmt">–§–æ—Ä–º–∞—Ç —á–∞—Å—É</label>
          <select id="timeFmt">
            <option value="0" selected>HH:MM:SS</option>
            <option value="1">HH.MM.SS</option>
            <option value="2">HH:MM</option>
          </select>
        </div>

        <div class="full-width">
          <label for="uniqueInput">–£–Ω—ñ–∫–∞–ª—å–Ω—ñ –Ω–æ–º–µ—Ä–∏ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label>
          <textarea id="uniqueInput" placeholder="–í—Å—Ç–∞–≤—Ç–µ –Ω–æ–º–µ—Ä–∏ –∑ –±—É—Ñ–µ—Ä–∞. –ö–æ–∂–µ–Ω –Ω–æ–º–µ—Ä ‚Äî –æ–∫—Ä–µ–º–∏–π —Ä—è–¥–æ–∫. –ë—É–¥—É—Ç—å –ø—Ä–∏–π–Ω—è—Ç—ñ –ª–∏—à–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ 9‚Äì15 —Ü–∏—Ñ—Ä."></textarea>
          <div class="hint">–ù–∞–ø—Ä.: 420778508935 ¬∑ 420778516894 ¬∑ 420778546006 ¬∑ ‚Ä¶</div>
        </div>

        <div class="full-width actions" style="margin-top:0.3rem;">
          <button type="submit" class="btn">üîÆ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
          <button type="button" id="clearBtn" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É</button>
        </div>
      </div>
    </form>

    <div id="errorBox" class="error hidden"></div>

    <div id="resultSection" class="hidden">
      <div class="result-bar">
        <div class="result-main" id="resultInfo"></div>
        <div class="result-extra" id="uniqueInfo"></div>
      </div>

      <div class="scroll-box">
        <table>
          <thead>
            <tr>
              <th>‚Ññ</th>
              <th>Unique</th>
              <th>DateTime</th>
            </tr>
          </thead>
          <tbody id="previewBody"></tbody>
        </table>
      </div>

      <div class="actions" style="margin-top:1.2rem;">
        <button id="downloadCsv" class="btn">‚¨áÔ∏é CSV</button>
        <button id="downloadXlsx" class="btn">‚¨áÔ∏é XLSX</button>
        <span class="chip">–ü–æ–∫–∞–∑—É—î—Ç—å—Å—è –º–∞–∫—Å–∏–º—É–º 500 —Ä—è–¥–∫—ñ–≤ –ø—Ä–µ–≤ º—é</span>
      </div>
    </div>
  </div>
</div>

<script>
// –¢–µ–º–∞
const themeBtn = document.getElementById('themeBtn');
const html = document.documentElement;

function setTheme(theme) {
  html.dataset.theme = theme;
  themeBtn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('ptg-theme', theme);
}

let savedTheme = localStorage.getItem('ptg-theme') || 'light';
setTheme(savedTheme);

themeBtn.addEventListener('click', () => {
  const current = html.dataset.theme;
  setTheme(current === 'dark' ? 'light' : 'dark');
});

// –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞
let generatedData = [];

const form = document.getElementById('genForm');
const errorBox = document.getElementById('errorBox');
const resultSection = document.getElementById('resultSection');
const resultInfo = document.getElementById('resultInfo');
const uniqueInfo = document.getElementById('uniqueInfo');
const previewBody = document.getElementById('previewBody');
const uniqueInput = document.getElementById('uniqueInput');
const countInput = document.getElementById('count');
const countHint = document.getElementById('countHint');

function pad(n) {
  return n.toString().padStart(2, '0');
}

// –ü–∞—Ä—Å–∏–Ω–≥ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤: —Ç—ñ–ª—å–∫–∏ 9‚Äì15 —Ü–∏—Ñ—Ä
function parseUniqueNumbers(raw) {
  if (!raw) return { valid: [], invalid: 0 };
  const lines = raw.split(/\r?\n/);
  const result = [];
  let invalid = 0;

  for (let line of lines) {
    const trimmed = line.trim();
    if (!trimmed) continue;

    const digits = trimmed.replace(/\D/g, '');
    if (/^[0-9]{9,15}$/.test(digits)) {
      result.push(digits);
    } else {
      invalid++;
    }
  }

  return { valid: result, invalid };
}

// –ê–≤—Ç–æ-–ª–æ–∫/–∞–Ω–ª–æ–∫ –ø–æ–ª—è count –ø—Ä–∏ –∑–º—ñ–Ω—ñ textarea
function updateCountLock() {
  const { valid } = parseUniqueNumbers(uniqueInput.value);

  if (valid.length > 0) {
    countInput.value = valid.length;
    countInput.disabled = true;
    countHint.textContent = `–ü–æ–ª–µ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ: –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∑–Ω–∞—á–µ–Ω–∞ –ø–æ –≤–∞–ª—ñ–¥–Ω–∏—Ö —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –Ω–æ–º–µ—Ä–∞—Ö (${valid.length}).`;
  } else {
    countInput.disabled = false;
    countHint.textContent = '–Ø–∫—â–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–µ –ø–æ–ª–µ ¬´–£–Ω—ñ–∫–∞–ª—å–Ω—ñ –Ω–æ–º–µ—Ä–∏¬ª ‚Äì –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –ø–æ —ó—Ö –∫—ñ–ª—å–∫–æ—Å—Ç—ñ.';
  }
}

uniqueInput.addEventListener('input', updateCountLock);

function showError(msg) {
  errorBox.textContent = msg;
  errorBox.classList.remove('hidden');
  resultSection.classList.add('hidden');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showPreview() {
  previewBody.innerHTML = '';

  const MAX_PREVIEW = 500;
  const toShow = generatedData.slice(0, MAX_PREVIEW);

  toShow.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${row.number}</td>
      <td>${row.unique || ''}</td>
      <td>${row.dateTime}</td>
    `;
    previewBody.appendChild(tr);
  });

  const uniqueDays = new Set(generatedData.map(r => r.dateTime.split(' ')[0])).size;
  let txt = `–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ <strong>${generatedData.length}</strong> –∑–∞–ø–∏—Å—ñ–≤ –∑–∞ <strong>${uniqueDays}</strong> —Ä—ñ–∑–Ω–∏—Ö —Ä–æ–±–æ—á–∏—Ö –¥–Ω—ñ–≤ (–ü–Ω‚Äì–ü—Ç, –≤–∏–ø–∞–¥–∫–æ–≤–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª)`;
  if (generatedData.length > MAX_PREVIEW) {
    txt += `, –ø–æ–∫–∞–∑–∞–Ω–æ –ø–µ—Ä—à—ñ ${MAX_PREVIEW}`;
  }
  resultInfo.innerHTML = txt;
}

form.addEventListener('submit', e => {
  e.preventDefault();
  errorBox.classList.add('hidden');
  resultSection.classList.add('hidden');
  uniqueInfo.textContent = '';

  const startStr = document.getElementById('start').value;
  const endStr   = document.getElementById('end').value;
  const count    = parseInt(countInput.value, 10);
  const dateFmt  = parseInt(document.getElementById('dateFmt').value, 10);
  const timeFmt  = parseInt(document.getElementById('timeFmt').value, 10);
  const uniqueRaw = uniqueInput.value;

  if (!startStr || !endStr) {
    showError('–í–∫–∞–∂—ñ—Ç—å –æ–±–∏–¥–≤—ñ –¥–∞—Ç–∏.');
    return;
  }

  const start = new Date(startStr);
  const end   = new Date(endStr);

  if (start > end) {
    showError('–î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ –¥–∞—Ç–∏ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è.');
    return;
  }

  if (isNaN(count) || count < 1 || count > 10000) {
    showError('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –º–∞—î –±—É—Ç–∏ –≤—ñ–¥ 1 –¥–æ 10000.');
    return;
  }

  const { valid: uniqueNumbers, invalid: invalidCount } = parseUniqueNumbers(uniqueRaw);

  let useUnique = uniqueNumbers.length > 0;
  let targetCount = count;

  if (uniqueRaw.trim().length > 0 && !useUnique) {
    showError('–£ –ø–æ–ª—ñ ¬´–£–Ω—ñ–∫–∞–ª—å–Ω—ñ –Ω–æ–º–µ—Ä–∏¬ª –Ω–µ–º–∞—î –∂–æ–¥–Ω–æ–≥–æ –≤–∞–ª—ñ–¥–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ (–æ—á—ñ–∫—É—î—Ç—å—Å—è 9‚Äì15 —Ü–∏—Ñ—Ä —É —Ä—è–¥–∫—É).');
    return;
  }

  if (useUnique) {
    targetCount = uniqueNumbers.length;
    let msg = `–í–∞–ª—ñ–¥–Ω–∏—Ö —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤: ${uniqueNumbers.length}.`;
    if (invalidCount > 0) {
      msg += ` –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ä—è–¥–∫—ñ–≤: ${invalidCount} (–Ω–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç/–¥–æ–≤–∂–∏–Ω–∞).`;
    }
    uniqueInfo.innerHTML = msg;
  }

  const workingDays = [];
  let current = new Date(start);
  while (current <= end) {
    const day = current.getDay();
    if (day !== 0 && day !== 6) {
      workingDays.push(new Date(current));
    }
    current.setDate(current.getDate() + 1);
  }

  if (workingDays.length === 0) {
    showError('–£ –≤–∏–±—Ä–∞–Ω–æ–º—É –ø–µ—Ä—ñ–æ–¥—ñ –Ω–µ–º–∞—î —Ä–æ–±–æ—á–∏—Ö –¥–Ω—ñ–≤ (–ü–Ω‚Äì–ü—Ç).');
    return;
  }

  generatedData = [];
  let globalIndex = 1;

  for (let i = 0; i < targetCount; i++) {
    const randomDayIndex = Math.floor(Math.random() * workingDays.length);
    const dayDate = workingDays[randomDayIndex];

    const y  = dayDate.getFullYear();
    const m  = dayDate.getMonth();
    const dd = dayDate.getDate();

    const h   = 9 + Math.floor(Math.random() * 10);
    const min = Math.floor(Math.random() * 60);
    const sec = Math.floor(Math.random() * 60);

    let datePart;
    switch (dateFmt) {
      case 0: datePart = `${y}-${pad(m+1)}-${pad(dd)}`; break;
      case 1: datePart = `${pad(dd)}.${pad(m+1)}.${y}`; break;
      case 2: datePart = `${pad(dd)}/${pad(m+1)}/${y}`; break;
      case 3: datePart = `${pad(m+1)}/${pad(dd)}/${y}`; break;
    }

    let timePart;
    if (timeFmt === 2) {
      timePart = `${pad(h)}:${pad(min)}`;
    } else {
      const sep = timeFmt === 0 ? ':' : '.';
      timePart = `${pad(h)}${sep}${pad(min)}${sep}${pad(sec)}`;
    }

    const dateTimeStr = datePart + ' ' + timePart;

    generatedData.push({
      number: globalIndex++,
      unique: useUnique ? (uniqueNumbers[i] || '') : '',
      dateTime: dateTimeStr,
      fullDate: new Date(y, m, dd, h, min, sec)
    });
  }

  // –í–ê–ñ–õ–ò–í–û: –Ω–µ —Å–æ—Ä—Ç—É—î–º–æ, —â–æ–± –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ª–∏—à–∏–≤—Å—è —è–∫ —É –≤–≤–µ–¥–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö

  showPreview();
  resultSection.classList.remove('hidden');
});

// –û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É
document.getElementById('clearBtn').addEventListener('click', () => {
  form.reset();
  countInput.disabled = false;
  countInput.value = 100;
  countHint.textContent = '–Ø–∫—â–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–µ –ø–æ–ª–µ ¬´–£–Ω—ñ–∫–∞–ª—å–Ω—ñ –Ω–æ–º–µ—Ä–∏¬ª ‚Äì –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –ø–æ —ó—Ö –∫—ñ–ª—å–∫–æ—Å—Ç—ñ.';
  uniqueInfo.textContent = '';
  errorBox.classList.add('hidden');
  resultSection.classList.add('hidden');
  generatedData = [];
});

// CSV
document.getElementById('downloadCsv').addEventListener('click', () => {
  if (!generatedData.length) return;

  const start = generatedData[0].dateTime.split(' ')[0].replace(/\D/g,'').slice(0,8);
  const end   = generatedData[generatedData.length-1].dateTime.split(' ')[0].replace(/\D/g,'').slice(0,8);
  const filename = `ptg-work-times-${start}-${end}.csv`;

  let csv = 'Number,Unique,DateTime\n';
  generatedData.forEach(r => {
    const uniqueEscaped = (r.unique || '').replace(/"/g, '""');
    const dtEscaped     = r.dateTime.replace(/"/g, '""');
    csv += `${r.number},"${uniqueEscaped}","${dtEscaped}"\n`;
  });

  const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  link.click();
  URL.revokeObjectURL(url);
});

// XLSX
document.getElementById('downloadXlsx').addEventListener('click', () => {
  if (!generatedData.length) return;

  const start = generatedData[0].dateTime.split(' ')[0].replace(/\D/g,'').slice(0,8);
  const end   = generatedData[generatedData.length-1].dateTime.split(' ')[0].replace(/\D/g,'').slice(0,8);
  const filename = `ptg-work-times-${start}-${end}.xlsx`;

  const ws_data = [
    ['Number', 'Unique', 'DateTime'],
    ...generatedData.map(r => [r.number, r.unique || '', r.dateTime])
  ];

  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Work Times');
  ws['!cols'] = [{wch:8}, {wch:18}, {wch:22}];

  XLSX.writeFile(wb, filename);
});

// —ñ–Ω—ñ—Ü—ñ–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω
updateCountLock();
</script>

</body>
</html>
