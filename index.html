<!DOCTYPE html>
<html lang="uk" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–æ–±–æ—á–∏—Ö –¥–∞—Ç —ñ —á–∞—Å—É</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    :root {
      --bg: #0d1117;
      --text: #c9d1d9;
      --card: #161b22;
      --border: #30363d;
      --accent: #58a6ff;
      --error: #f85149;
      --success: #3fb950;
      --muted: #8b949e;
    }
    [data-theme="light"] {
      --bg: #ffffff;
      --text: #24292e;
      --card: #f6f8fa;
      --border: #d0d7de;
      --accent: #0969da;
      --error: #d73a49;
      --success: #2ea44f;
      --muted: #57606a;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      line-height: 1.5;
    }

    .container { max-width: 900px; margin: 0 auto; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
    h1 { margin: 0; font-size: 1.8rem; }

    .theme-toggle {
      background: none;
      border: 1px solid var(--border);
      color: var(--text);
      font-size: 1.2rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.2rem;
      margin-bottom: 1.5rem;
    }
    @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }

    label { display: block; margin-bottom: 0.4rem; font-weight: 500; }
    input, select, textarea {
      width: 100%;
      padding: 0.6rem 0.9rem;
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 6px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    textarea { resize: vertical; font-family: monospace; }
    input[readonly] { background: var(--border); cursor: not-allowed; opacity: 0.7; }

    .full-width { grid-column: 1 / -1; }
    .help-text { font-size: 0.85rem; color: var(--muted); margin-top: 0.3rem; display: block; }

    .btn {
      padding: 0.7rem 1.4rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: var(--accent);
      color: white;
      transition: background 0.15s;
    }
    .btn:hover { background: #539bf5; }
    .btn-secondary {
      background: var(--border);
      color: var(--text);
    }
    .btn-secondary:hover { background: #444d56; }

    .error {
      color: var(--error);
      background: rgba(248,81,73,0.12);
      padding: 0.8rem;
      border-radius: 6px;
      margin: 1rem 0;
      border-left: 4px solid var(--error);
    }

    .result-info { margin: 1.5rem 0 1rem; font-weight: 500; }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 1.5rem;
    }
    th, td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    th { background: rgba(88,166,255,0.12); font-weight: 600; }

    .actions {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-top: 1.5rem;
    }
    .hidden { display: none; }
  </style>
</head>
<body>

<div class="container">

  <header>
    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–æ–±–æ—á–∏—Ö –¥–∞—Ç —ñ —á–∞—Å—É</h1>
    <button class="theme-toggle" id="themeBtn" title="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">‚òÄÔ∏è</button>
  </header>

  <form id="genForm">
    <div class="form-grid">
      <div>
        <label for="start">–î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É</label>
        <input type="date" id="start" required>
      </div>
      <div>
        <label for="end">–î–∞—Ç–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è</label>
        <input type="date" id="end" required>
      </div>
      <div>
        <label for="dateFmt">–§–æ—Ä–º–∞—Ç –¥–∞—Ç–∏</label>
        <select id="dateFmt">
          <option value="0">YYYY-MM-DD</option>
          <option value="1" selected>DD.MM.YYYY</option>
          <option value="2">DD/MM/YYYY</option>
          <option value="3">MM/DD/YYYY</option>
        </select>
      </div>
      <div>
        <label for="timeFmt">–§–æ—Ä–º–∞—Ç —á–∞—Å—É</label>
        <select id="timeFmt">
          <option value="0" selected>HH:MM:SS</option>
          <option value="1">HH.MM.SS</option>
          <option value="2">HH:MM</option>
        </select>
      </div>
      <div>
        <label for="count">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤</label>
        <input type="number" id="count" min="1" max="100000" value="100" required>
      </div>
      <div class="full-width">
        <label for="uniqueIds">–£–Ω—ñ–∫–∞–ª—å–Ω—ñ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ (–∑ –±—É—Ñ–µ—Ä–∞)</label>
        <textarea id="uniqueIds" rows="5" placeholder="–í—Å—Ç–∞–≤—Ç–µ —Å—é–¥–∏ —Å–ø–∏—Å–æ–∫ –Ω–æ–º–µ—Ä—ñ–≤ (–∫–æ–∂–µ–Ω –∑ –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞)&#10;–ù–∞–ø—Ä–∏–∫–ª–∞–¥:&#10;420778508935&#10;420778516894"></textarea>
        <span class="help-text">–Ø–∫—â–æ –≤—Å—Ç–∞–≤–∏—Ç–∏ —Å—é–¥–∏ –¥–∞–Ω—ñ, –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ —Ä–æ–∑—Ä–∞—Ö—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.</span>
      </div>
      
      <div class="full-width" style="display:flex; gap:1rem; flex-wrap:wrap; margin-top:1.2rem;">
        <button type="submit" class="btn">–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏</button>
        <button type="button" id="clearBtn" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç–∏</button>
      </div>
    </div>
  </form>

  <div id="errorBox" class="error hidden"></div>

  <div id="resultSection" class="hidden">
    <div class="result-info" id="resultInfo"></div>

    <div style="max-height:500px; overflow:auto; border:1px solid var(--border); border-radius:6px;">
      <table id="previewTable">
        <thead>
          <tr id="tableHeaderRow">
            <th>‚Ññ</th>
            <th>DateTime</th>
          </tr>
        </thead>
        <tbody id="previewBody"></tbody>
      </table>
    </div>

    <div class="actions">
      <button id="downloadCsv" class="btn">–°–∫–∞—á–∞—Ç–∏ CSV</button>
      <button id="downloadXlsx" class="btn">–°–∫–∞—á–∞—Ç–∏ XLSX</button>
    </div>
  </div>

</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–º–∏
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const themeBtn = document.getElementById('themeBtn');
const html = document.documentElement;

function setTheme(theme) {
  html.dataset.theme = theme;
  themeBtn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('theme', theme);
}

let savedTheme = localStorage.getItem('theme') || 'dark';
setTheme(savedTheme);

themeBtn.addEventListener('click', () => {
  const current = html.dataset.theme;
  setTheme(current === 'dark' ? 'light' : 'dark');
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// –õ–æ–≥—ñ–∫–∞ –≤–≤–µ–¥–µ–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const uniqueIdsInput = document.getElementById('uniqueIds');
const countInput = document.getElementById('count');
let parsedUniqueIds = [];
let hasUniqueIds = false;

uniqueIdsInput.addEventListener('input', () => {
  // –†–æ–∑–±–∏–≤–∞—î–º–æ —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—è–¥–∫–∏, –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –ø–æ—Ä–æ–∂–Ω—ñ —Ä—è–¥–∫–∏
  const lines = uniqueIdsInput.value.split('\n').map(l => l.trim()).filter(l => l.length > 0);
  if (lines.length > 0) {
    countInput.value = lines.length;
    countInput.readOnly = true;
  } else {
    countInput.readOnly = false;
  }
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let generatedData = [];

const form = document.getElementById('genForm');
const errorBox = document.getElementById('errorBox');
const resultSection = document.getElementById('resultSection');
const resultInfo = document.getElementById('resultInfo');
const previewBody = document.getElementById('previewBody');
const tableHeaderRow = document.getElementById('tableHeaderRow');

form.addEventListener('submit', e => {
  e.preventDefault();
  errorBox.classList.add('hidden');
  resultSection.classList.add('hidden');

  const startStr = document.getElementById('start').value;
  const endStr   = document.getElementById('end').value;
  let count      = parseInt(countInput.value);
  const dateFmt  = parseInt(document.getElementById('dateFmt').value);
  const timeFmt  = parseInt(document.getElementById('timeFmt').value);

  // –û—Ç—Ä–∏–º—É—î–º–æ –º–∞—Å–∏–≤ ID
  parsedUniqueIds = uniqueIdsInput.value.split('\n').map(l => l.trim()).filter(l => l.length > 0);
  hasUniqueIds = parsedUniqueIds.length > 0;
  
  if (hasUniqueIds) {
      count = parsedUniqueIds.length;
  }

  if (!startStr || !endStr) {
    showError('–í–∫–∞–∂—ñ—Ç—å –æ–±–∏–¥–≤—ñ –¥–∞—Ç–∏');
    return;
  }

  const start = new Date(startStr);
  const end   = new Date(endStr);

  if (start > end) {
    showError('–î–∞—Ç–∞ –ø–æ—á–∞—Ç–∫—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø—ñ–∑–Ω—ñ—à–µ –¥–∞—Ç–∏ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è');
    return;
  }

  if (isNaN(count) || count < 1) {
    showError('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –º–∞—î –±—É—Ç–∏ –±—ñ–ª—å—à–µ 0');
    return;
  }

  // –ó–±–∏—Ä–∞—î–º–æ —Ä–æ–±–æ—á—ñ –¥–Ω—ñ
  const workingDays = [];
  let current = new Date(start);
  while (current <= end) {
    const day = current.getDay();
    if (day !== 0 && day !== 6) {
      workingDays.push(new Date(current));
    }
    current.setDate(current.getDate() + 1);
  }

  if (workingDays.length === 0) {
    showError('–£ –≤–∏–±—Ä–∞–Ω–æ–º—É –ø–µ—Ä—ñ–æ–¥—ñ –Ω–µ–º–∞—î —Ä–æ–±–æ—á–∏—Ö –¥–Ω—ñ–≤ (–ü–Ω‚Äì–ü—Ç)');
    return;
  }

  // 1. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–∞—Ç
  let tempDates = [];
  for (let i = 0; i < count; i++) {
    const randomDayIndex = Math.floor(Math.random() * workingDays.length);
    const dayDate = workingDays[randomDayIndex];

    const y  = dayDate.getFullYear();
    const m  = dayDate.getMonth();
    const dd = dayDate.getDate();

    // –†–æ–±–æ—á–∏–π —á–∞—Å: –≤—ñ–¥ 09:00 –¥–æ 18:59
    const h   = 9 + Math.floor(Math.random() * 10);
    const min = Math.floor(Math.random() * 60);
    const sec = Math.floor(Math.random() * 60);

    tempDates.push(new Date(y, m, dd, h, min, sec));
  }

  // 2. –°–æ—Ä—Ç—É—î–º–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –¥–∞—Ç–∏ —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–æ
  tempDates.sort((a, b) => a - b);

  // 3. –§–æ—Ä–º—É—î–º–æ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –º–∞—Å–∏–≤
  generatedData = [];
  
  for (let i = 0; i < count; i++) {
    const d = tempDates[i];
    
    // –§–æ—Ä–º–∞—Ç –¥–∞—Ç–∏
    let datePart;
    switch (dateFmt) {
      case 0: datePart = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; break;
      case 1: datePart = `${pad(d.getDate())}.${pad(d.getMonth()+1)}.${d.getFullYear()}`; break;
      case 2: datePart = `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()}`; break;
      case 3: datePart = `${pad(d.getMonth()+1)}/${pad(d.getDate())}/${d.getFullYear()}`; break;
    }

    // –§–æ—Ä–º–∞—Ç —á–∞—Å—É
    let timePart;
    if (timeFmt === 2) {
      timePart = `${pad(d.getHours())}:${pad(d.getMinutes())}`;
    } else {
      const sep = timeFmt === 0 ? ':' : '.';
      timePart = `${pad(d.getHours())}${sep}${pad(d.getMinutes())}${sep}${pad(d.getSeconds())}`;
    }

    generatedData.push({
      number: i + 1,
      uniqueId: hasUniqueIds ? parsedUniqueIds[i] : null,
      dateTime: datePart + ' ' + timePart,
      fullDate: d
    });
  }

  updateTableHeaders();
  showPreview();
  resultSection.classList.remove('hidden');
});

function pad(n) {
  return n.toString().padStart(2, '0');
}

function showError(msg) {
  errorBox.textContent = msg;
  errorBox.classList.remove('hidden');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function updateTableHeaders() {
    if (hasUniqueIds) {
        tableHeaderRow.innerHTML = `<th>‚Ññ</th><th>Unique ID</th><th>DateTime</th>`;
    } else {
        tableHeaderRow.innerHTML = `<th>‚Ññ</th><th>DateTime</th>`;
    }
}

function showPreview() {
  previewBody.innerHTML = '';

  const MAX_PREVIEW = 500;
  const toShow = generatedData.slice(0, MAX_PREVIEW);

  toShow.forEach(row => {
    const tr = document.createElement('tr');
    if (hasUniqueIds) {
        tr.innerHTML = `<td>${row.number}</td><td>${row.uniqueId}</td><td>${row.dateTime}</td>`;
    } else {
        tr.innerHTML = `<td>${row.number}</td><td>${row.dateTime}</td>`;
    }
    previewBody.appendChild(tr);
  });

  const uniqueDays = new Set(generatedData.map(r => r.dateTime.split(' ')[0])).size;
  let txt = `–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ <strong>${generatedData.length}</strong> –∑–∞–ø–∏—Å—ñ–≤ –∑–∞ <strong>${uniqueDays}</strong> —Ä—ñ–∑–Ω–∏—Ö —Ä–æ–±–æ—á–∏—Ö –¥–Ω—ñ–≤`;
  if (generatedData.length > MAX_PREVIEW) {
    txt += ` (–ø–æ–∫–∞–∑–∞–Ω–æ –ø–µ—Ä—à—ñ ${MAX_PREVIEW})`;
  }
  resultInfo.innerHTML = txt;
}

// –û—á–∏—Å—Ç–∏—Ç–∏
document.getElementById('clearBtn').addEventListener('click', () => {
  form.reset();
  countInput.value = 100;
  countInput.readOnly = false;
  errorBox.classList.add('hidden');
  resultSection.classList.add('hidden');
  generatedData = [];
  parsedUniqueIds = [];
  hasUniqueIds = false;
});

// CSV
document.getElementById('downloadCsv').addEventListener('click', () => {
  if (!generatedData.length) return;

  const start = generatedData[0].dateTime.split(' ')[0].replace(/\D/g,'').slice(0,8);
  const end   = generatedData[generatedData.length-1].dateTime.split(' ')[0].replace(/\D/g,'').slice(0,8);
  const filename = `random-work-times-${start}-${end}.csv`;

  let csv = hasUniqueIds ? 'Number,Unique,DateTime\n' : 'Number,DateTime\n';
  generatedData.forEach(r => {
    if (hasUniqueIds) {
        csv += `${r.number},"${r.uniqueId}","${r.dateTime.replace(/"/g, '""')}"\n`;
    } else {
        csv += `${r.number},"${r.dateTime.replace(/"/g, '""')}"\n`;
    }
  });

  const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  link.click();
  URL.revokeObjectURL(url);
});

// XLSX
document.getElementById('downloadXlsx').addEventListener('click', () => {
  if (!generatedData.length) return;

  const start = generatedData[0].dateTime.split(' ')[0].replace(/\D/g,'').slice(0,8);
  const end   = generatedData[generatedData.length-1].dateTime.split(' ')[0].replace(/\D/g,'').slice(0,8);
  const filename = `random-work-times-${start}-${end}.xlsx`;

  let ws_data = [];
  if (hasUniqueIds) {
      ws_data.push(['Number', 'Unique', 'DateTime']);
      generatedData.forEach(r => ws_data.push([r.number, r.uniqueId, r.dateTime]));
  } else {
      ws_data.push(['Number', 'DateTime']);
      generatedData.forEach(r => ws_data.push([r.number, r.dateTime]));
  }

  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Work Times');
  
  // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —à–∏—Ä–∏–Ω–∏ –∫–æ–ª–æ–Ω–æ–∫
  if (hasUniqueIds) {
      ws['!cols'] = [{wch:8}, {wch:15}, {wch:20}];
  } else {
      ws['!cols'] = [{wch:8}, {wch:20}];
  }

  XLSX.writeFile(wb, filename);
});

</script>
</body>
</html>
